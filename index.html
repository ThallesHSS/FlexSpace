<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>FlexSpace ‚Äî Demo Corporativa</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg: #f5fefd;
    --card: #ffffff;
    --muted: #6b7a80;
    --brand: #2bc3cc;
    --accent: #32ebc0;
    --text: #053f4e;
    --glass: rgba(255,255,255,0.6);
    --shadow: 0 8px 24px rgba(6,20,25,0.08);
    --radius: 14px;
    --soft-radius: 10px;
    --transition: 250ms cubic-bezier(.2,.9,.3,1);
  }


  /* dark */
  .dark {
    --bg: #0f1720;
    --card: #0b1220;
    --muted: #9aa7b0;
    --brand: #6a9bd6;
    --accent: #7fd3d1;
    --text: #e6f0f3;
    --glass: rgba(255,255,255,0.03);
    --shadow: 0 10px 30px rgba(2,6,12,0.6);
  }

  /* alto contraste */
.high-contrast {
  --bg: #000000;
  --card: #000000;
  --muted: #ffffff;
  --brand: #ffff00;
  --accent: #00ffff;
  --text: #ffffff;
  --glass: rgba(255,255,255,0.15);
  --shadow: none;
}

.high-contrast a,
.high-contrast button,
.high-contrast select,
.high-contrast input {
  border: 2px solid #ffffff !important;
  color: #ffffff !important;
  background: #000000 !important;
}

.high-contrast .btn.primary {
  background: #ffff00 !important;
  color: #000000 !important;
}

.high-contrast .logo {
  background: linear-gradient(135deg, #ffff00, #00ffff) !important;
}


  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
    background:linear-gradient(180deg,var(--bg), #eafefefd 120%);
    color:var(--text);
    margin:0; -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    -webkit-tap-highlight-color:transparent;
  }


  /* Header */
  header{
    position:sticky; top:0; z-index:60;
    backdrop-filter: blur(6px);
    background: linear-gradient(90deg, rgba(255,255,255,0.55), rgba(255,255,255,0.35));
    border-bottom: 1px solid rgba(0,0,0,0.04);
    padding:12px 20px; display:flex; align-items:center; justify-content:space-between;
  }
  .dark header{
    background: linear-gradient(90deg, rgba(10,14,20,0.6), rgba(10,14,20,0.4));
    border-bottom-color: rgba(255,255,255,0.03);
  }
  .brand { display:flex; align-items:center; gap:12px; }
  .logo {
    width:44px; height:44px; border-radius:10px;
    background:linear-gradient(135deg,var(--brand),var(--accent));
    box-shadow: var(--shadow);
    display:grid; place-items:center; color:#fff; font-weight:700;
  }
  .brand h1{font-size:1rem;margin:0}
  nav.topnav{display:flex; gap:18px; align-items:center;}
  nav.topnav a{color:var(--text); text-decoration:none; font-weight:600; opacity:.95; font-size:.95rem}
  nav.topnav a:hover{opacity:1; transform:translateY(-2px)}
  .controls{display:flex; gap:10px; align-items:center}
  button.icon-btn{
    border:0; background:transparent; padding:8px; border-radius:10px; cursor:pointer;
    display:inline-grid; place-items:center; transition:all var(--transition);
  }
  button.icon-btn:hover{transform:translateY(-3px)}


  /* Layout */
  main{max-width:1100px;margin:24px auto;padding:0 20px;}
  .hero{
    display:grid; grid-template-columns: 1fr 420px; gap:28px; align-items:center;
    margin-bottom:28px;
  }
  .hero-card{
    background:var(--card); border-radius:var(--radius); padding:28px;
    box-shadow:var(--shadow); transition:transform var(--transition);
  }
  .hero-card h2{margin:0 0 8px;font-size:1.6rem;letter-spacing:-0.2px}
  .hero-card p{color:var(--muted); margin:0 0 18px}
  .hero-actions{display:flex; gap:12px; margin-top:10px}
  .btn{padding:10px 14px; border-radius:10px; border:0; cursor:pointer; font-weight:600}
  .btn.primary{background:var(--brand); color:#fff; box-shadow: 0 8px 18px rgba(43,195,204,0.18)}
  .btn.ghost{background:transparent; border:1px solid rgba(0,0,0,0.06)}


  .hero-visual{
    border-radius:var(--radius); overflow:hidden; box-shadow:var(--shadow);
    height:260px; background-size:cover; background-position:center;
  }


  /* Search & filter */
  .searchbar{display:flex; gap:12px; margin-top:14px; align-items:center}
  .searchbar input{
    flex:1;padding:12px 14px;border-radius:12px;border:1px solid rgba(0,0,0,0.06);
    background:var(--glass); color:var(--text);
  }
  .searchbar select{
    padding:12px;border-radius:12px;border:1px solid rgba(0,0,0,0.06);
    background:var(--card); color:var(--text);
  }


  /* Grid cards */
  .grid{display:grid; grid-template-columns: repeat(3, 1fr); gap:18px; margin-top:18px;}
  .card{
    background:var(--card); border-radius:12px; overflow:hidden; box-shadow:var(--shadow);
    display:flex; flex-direction:column; transition:transform var(--transition), box-shadow var(--transition);
    min-height:320px;
  }
  .card:hover{transform:translateY(-8px); box-shadow: 0 22px 40px rgba(6,20,25,0.12)}
  .card-media{height:150px; background-size:cover; background-position:center}
  .card-body{padding:14px 16px; display:flex; flex-direction:column; gap:10px; flex:1}
  .card-title{font-weight:700; font-size:1.05rem}
  .card-desc{color:var(--muted); font-size:0.95rem; flex:1}
  .card-footer{display:flex; align-items:center; justify-content:space-between; gap:12px}
  .card-actions{display:flex; gap:8px; align-items:center}


  /* rating */
  .stars{display:flex; gap:6px; align-items:center}
  .star{
    font-size:20px; color: #cbd5d9; cursor:pointer; transition: color 180ms;
    text-shadow: 0 1px 0 rgba(0,0,0,0.06);
    user-select:none;
  }
  .star.on{ color: #ffd65a; }
  .rating-count{color:var(--muted); font-size:0.85rem}


  /* overlay quick */
  .overlay-trigger{position:absolute; inset:12px; border-radius:12px; pointer-events:none}
  .card .card-overlay{
    position:absolute; right:12px; top:12px; background:rgba(0,0,0,0.05); padding:6px;border-radius:10px; pointer-events:auto;
  }


  /* footer */
  footer.site-footer{margin:36px auto 80px; text-align:center; color:var(--muted); font-size:0.95rem}


  /* responsive */
  @media (max-width:980px){
    .hero{grid-template-columns:1fr; gap:16px}
    .grid{grid-template-columns:repeat(2,1fr)}
    .hero-visual{height:200px}
  }
  @media (max-width:620px){
    header{padding:12px}
    nav.topnav{display:none}
    .grid{grid-template-columns:1fr}
    .hero-visual{height:160px}
    .hero-card{padding:18px}
  }


  /* subtle helpers */
  .muted{color:var(--muted)}
  .small{font-size:.85rem}
  a.btn-link{color:var(--brand); text-decoration:none; font-weight:600}
  /* accessibility focus */
  .star:focus, .icon-btn:focus, .btn:focus, input:focus, select:focus{outline:3px solid rgba(43,195,204,0.14); outline-offset:2px}
</style>
</head>
<body>


<header role="banner" aria-label="Cabe√ßalho do site">
  <div class="brand">
    <div class="logo" aria-hidden="true"><img src="https://thalleshss.github.io/FlexSpace/Logo flexspace.jfif" class="logo" aria-hidden="true"></div>
    <div>
      <h1 style="font-size:0.95rem;margin:0">FlexSpace</h1>
      <div class="small muted">Demonstra√ß√£o Corporativa</div>
    </div>
  </div>


  <nav class="topnav" role="navigation" aria-label="Menu principal">
    <a href="#sobre">Perfil</a>
    <a href="#espacos">Minha Empresa</a>
    <a href="#contato">Configura√ß√µes</a>
  </nav>


 <div class="controls" aria-hidden="false">
  <button class="icon-btn" id="toggleTheme" title="Alternar tema (lido pelo leitor)">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
      <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z" fill="currentColor"/>
    </svg>
  </button>

  <!-- novo bot√£o de acessibilidade -->
  <button class="icon-btn" id="toggleReader" title="Ativar leitor de texto" aria-label="Ativar leitor de texto">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
      <path d="M3 10v4a1 1 0 001 1h2l3 3V6L6 9H4a1 1 0 00-1 1zm13.54-3.54a5 5 0 010 7.07m2.83-9.9a9 9 0 010 12.73"
        stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
  </button>

  <button class="icon-btn" title="Ajuda" aria-label="Ajuda">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
      <path d="M12 2a10 10 0 100 20 10 10 0 000-20zM11 17h2v-2h-2v2zm2.07-7.75a2 2 0 10-3.14 1.76"
        stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
  </button>

   <button class="icon-btn" id="toggleContrast" title="Ativar alto contraste" aria-label="Ativar alto contraste">
  <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
    <path d="M12 2a10 10 0 100 20 10 10 0 000-20zM12 6v12" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
  </svg>
</button>
</div>
</header>


<main>
  <!-- HERO -->
  <section class="hero" aria-labelledby="hero-title">
    <div class="hero-card" role="region" aria-label="Informa√ß√µes sobre a demonstra√ß√£o">
      <h2 id="hero-title">Demonstra√ß√£o FlexSpace ‚Äî Contabilidade XYZ</h2>
      <p>Gerencie, visualize e avalie os espa√ßos da sua empresa. Clique em um espa√ßo para ver op√ß√µes, ou avalie com estrelas.</p>


      <div class="searchbar" role="search">
        <input id="searchInput" placeholder="Procurar espa√ßo (ex: Sala de reuni√£o, Banheiro...)" aria-label="Procurar espa√ßos">
        <select id="filterSelect" aria-label="Filtrar por tipo">
          <option value="">Todos os tipos</option>
          <option value="escritorio">Escrit√≥rio</option>
          <option value="reuniao">Sala de Reuni√£o</option>
          <option value="banheiro">Banheiro</option>
          <option value="comum">√Årea Comum</option>
        </select>
        <button class="btn primary" id="newDemoBtn">Agendar Demo</button>
      </div>


      <div style="margin-top:14px; display:flex; gap:12px; align-items:center;">
        <div class="muted small">Exibindo <strong id="visibleCount">0</strong> espa√ßos</div>
        <div style="flex:1"></div>
        <a href="#espacos" class="btn ghost">Ver espa√ßos</a>
      </div>
    </div>


    <div class="hero-visual" role="img" aria-label="Imagem de ambiente corporativo" style="background-image: url('https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTZQ6JzKX9La8o_2GV68nfg5YB9cI9DaAyhbw&s');"></div>
  </section>


  <!-- CARDS -->
  <section id="espacos" class="section" aria-labelledby="espacos-title">
    <h3 id="espacos-title" style="margin:0 0 8px">Espa√ßos Dispon√≠veis</h3>
    <p class="muted small" style="margin-top:0">Passe o mouse (ou toque) nos cards para ver op√ß√µes r√°pidas. Avalie cada espa√ßo com as estrelas.</p>


    <div class="grid" id="cardsGrid" aria-live="polite">
      <!-- cards ser√£o inseridos por JS -->
    </div>
  </section>


  <!-- Sobre / contato -->
  <section id="sobre" style="margin-top:30px; display:flex; gap:20px; align-items:flex-start;">
    <div style="flex:1" class="hero-card">
      <h4 style="margin-top:0">Sobre a Empresa</h4>
      <p class="muted">A Contabilidade XYZ utiliza a FlexSpace para gerenciar salas de reuni√µes, escrit√≥rios e √°reas comuns. Aqui √© s√≥ uma demonstra√ß√£o que mostra a interface e intera√ß√µes com os espa√ßos.</p>
      <p class="small muted">Este prot√≥tipo n√£o grava em servidor ‚Äî as avalia√ß√µes ficam salvas apenas no seu navegador.</p>
    </div>


    <div style="width:320px" class="hero-card">
      <h4 style="margin-top:0">Contato</h4>
      <p class="muted small">Demo / Suporte: <strong>demo@flexspace.com</strong></p>
      <p style="margin-top:12px"><a href="#" class="btn primary" style="width:100%;text-align:center">Solicitar apresenta√ß√£o</a></p>
    </div>
    <ul id="listaEspacos"></ul>
  </section>
</main>


<footer class="site-footer" role="contentinfo">
  FlexSpace ¬© <span id="year"></span> ‚Äî Esta √© uma demonstra√ß√£o corporativa. Layout inspirado em aplicativos e sites organizacionais.
</footer>


<script>
/* Data inicial dos espa√ßos (voc√™ pode editar, carregar via API etc.) */
const spaces = [
  { id: 'esp-1', type:'escritorio', title:'Escrit√≥rio Principal', desc:'Espa√ßo moderno para a equipe trabalhar de forma confort√°vel.', img:'https://www.divdesign.com.br/wp-content/uploads/2021/11/tendencias-moveis-escritorio-div-design.jpg' },
  { id: 'esp-2', type:'reuniao', title:'Sala de Reuni√£o', desc:'Sala equipada para apresenta√ß√µes e reuni√µes com clientes.', img:'https://funcional.wpcdn.com.br/blog/2023/05/FUNCIONAL_blog_16-05-1.png' },
  { id: 'esp-3', type:'banheiro', title:'Banheiros', desc:'Banheiros limpos e acess√≠veis para equipe e visitantes.', img:'https://s32907.pcdn.co/wp-content/uploads/2020/03/revestimento-de-banheiro-01032020.jpg' },
  { id: 'esp-4', type:'lazer', title:'√Årea Comum', desc:'Lounge e caf√© para pausas, networking e eventos internos.', img:'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSMcmmlozZlIxAUweMOYjzeRhITuLolo-TrkA&s' },
  { id: 'esp-5', type:'escritorio', title:'Escrit√≥rio Financeiro', desc:'Ambiente reservado para equipe financeira e reuni√µes confidenciais.', img:'https://cdn.cobrefacil.com.br/website/base/650/c4c/a7b/departamento-financeiro.jpg' },
  { id: 'esp-6', type:'lazer', title:'Sala de Lazer', desc:'Sala grande e aconchegante para o descanso dos funcion√°rios.', img:'https://qtmov.com.br/blog/wp-content/uploads/2023/06/blog-O-que-nao-pode-faltar-em-uma-sala-de-descanso-na-empresa-qtmov.jpeg' },
  { id: 'esp-6', type:'reuniao', title:'Sala de Treinamento', desc:'Sala grande com projetor para treinamentos e workshops.', img:'https://images.unsplash.com/photo-1542744173-8e7e53415bb0?q=80&w=1200&auto=format&fit=crop' },
  { id: 'esp-6', type:'alimenta√ß√£o', title:'Cantina', desc:'Cantina onde os funcion√°rios podem comprar seus lanches.', img:'https://img.freepik.com/fotos-premium/cantina-de-uma-empresa-start-up-moderna_260036-237.jpg' },
  { id: 'esp-6', type:'alimenta√ß√£o', title:'Pra√ßa de alimenta√ß√£o', desc:'Local onde os funcion√°rios se alimentam e interagem entre s√≠.', img:'https://png.pngtree.com/png-clipart/20200701/original/pngtree-three-dimensional-company-canteen-png-image_5406368.jpg' },
];


/* Utils: rating persistence in localStorage */
const STORAGE_KEY = 'flexspace_ratings_v1';
function loadRatings(){ try{ return JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}'); }catch(e){return {} } }
function saveRatings(obj){ localStorage.setItem(STORAGE_KEY, JSON.stringify(obj)); }


/* Render cards */
const grid = document.getElementById('cardsGrid');
const visibleCount = document.getElementById('visibleCount');


function createCard(space, ratingState){
  const card = document.createElement('article');
  card.className = 'card';
  card.setAttribute('data-id', space.id);
  card.setAttribute('tabindex', '0');
  card.innerHTML = `
    <div class="card-media" style="background-image: url('${space.img}')"></div>
    <div class="card-body">
      <div style="display:flex;gap:10px;align-items:flex-start;">
        <div style="flex:1">
          <div class="card-title">${space.title}</div>
          <div class="card-desc">${space.desc}</div>
        </div>
      </div>


      <div class="card-footer" style="margin-top:8px">
        <div>
          <div class="stars" role="radiogroup" aria-label="Avalia√ß√£o de ${space.title}">
            ${[1,2,3,4,5].map(i => `<span class="star" role="radio" tabindex="0" data-value="${i}" aria-checked="${(ratingState||0)===i? 'true':'false'}" title="${i} estrela">${i<= (ratingState||0) ? '&#9733;':'&#9733;'}</span>`).join('')}
          </div>
          <div class="rating-count small muted" style="margin-top:6px"><span class="rating-value">${ratingState||0}</span> ‚òÖ ‚Äî <span class="small muted">base: demo</span></div>
        </div>
        <div class="card-actions">
          <button class="btn" data-action="details" aria-label="Detalhes de ${space.title}">Detalhes</button>
          <button class="btn primary" data-action="book" aria-label="Agendar ${space.title}">Agendar</button>
        </div>
      </div>
    </div>
  `;
  attachStarHandlers(card, space.id);
  attachActionHandlers(card, space);
  return card;
}


/* Attach actions */
function attachActionHandlers(card, space){
  card.querySelectorAll('button[data-action]').forEach(btn=>{
    btn.addEventListener('click', e=>{
      const act = btn.getAttribute('data-action');
      if(act==='details'){
        const links = {
          'Escrit√≥rio Principal': 'https://thalleshss.github.io/FlexSpace/FlexDt/Detalhes%20escrit%C3%B3rio.html',
          'Sala de Reuni√£o': 'https://thalleshss.github.io/FlexSpace/FlexDt/Detalhes%20sala%20reuni%C3%A3o.html',
          'Banheiros': 'https://thalleshss.github.io/FlexSpace/FlexDt/Banheiros%20dt.html',
          '√Årea Comum': 'https://thalleshss.github.io/FlexSpace/FlexDt/Arc%20dt.html',
          'Escrit√≥rio Financeiro': 'https://thalleshss.github.io/FlexSpace/FlexDt/Escfndt.html',
          'Sala de Lazer': 'https://thalleshss.github.io/FlexSpace/FlexDt/sllzdt.html',
          'Sala de Treinamento': 'https://thalleshss.github.io/FlexSpace/FlexDt/strdt.html',
          'Cantina': 'https://thalleshss.github.io/FlexSpace/FlexDt/Ctdt.html',
          'Pra√ßa de alimenta√ß√£o': 'https://thalleshss.github.io/FlexSpace/FlexDt/padt.html'
        };

        const url = links[space.title];
        if(url){
          window.location.href = url;
        } else {
          alert(`P√°gina de detalhes n√£o encontrada para: ${space.title}`);
        }
      } 
      else if(act==='book'){
        alert(`Abrir agendamento para: ${space.title}\n\n(Simula√ß√£o demo)`);
      }
    });
  });
}


/* Stars handlers (hover + click + keyboard) */
function attachStarHandlers(card, id){
  const stars = card.querySelectorAll('.star');
  const ratingEl = card.querySelector('.rating-value');
  let ratings = loadRatings();
  let current = ratings[id] || 0;


  function updateVisual(n){
    stars.forEach((s, i)=> s.classList.toggle('on', i < n));
    ratingEl.textContent = n;
  }
  updateVisual(current);


  stars.forEach((s, idx)=>{
    const val = idx+1;
    // pointer
    s.addEventListener('mouseenter', ()=> updateVisual(val));
    s.addEventListener('mouseleave', ()=> updateVisual(ratings[id] || 0));
    s.addEventListener('click', ()=>{
      ratings[id] = val;
      saveRatings(ratings);
      updateVisual(val);
      // feedback
      s.closest('.card').style.boxShadow = '0 30px 50px rgba(43,195,204,0.08)';
    });
    // keyboard accessibility
    s.addEventListener('keydown', (ev)=>{
      if(ev.key === 'Enter' || ev.key === ' '){
        ev.preventDefault();
        ratings[id] = val;
        saveRatings(ratings);
        updateVisual(val);
      } else if(ev.key === 'ArrowLeft' || ev.key==='ArrowDown'){
        ev.preventDefault();
        const newVal = Math.max(0, (ratings[id]||0) - 1);
        ratings[id] = newVal; saveRatings(ratings); updateVisual(newVal);
      } else if(ev.key === 'ArrowRight' || ev.key==='ArrowUp'){
        ev.preventDefault();
        const newVal = Math.min(5, (ratings[id]||0) + 1);
        ratings[id] = newVal; saveRatings(ratings); updateVisual(newVal);
      }
    });
  });
}


/* Initial mount */
function mountCards(list){
  grid.innerHTML = '';
  const ratings = loadRatings();
  list.forEach(s => {
    const r = ratings[s.id] || 0;
    grid.appendChild(createCard(s, r));
  });
  visibleCount.textContent = list.length;
}


/* Filters & search */
const searchInput = document.getElementById('searchInput');
  const filterSelect = document.getElementById('filterSelect');


  function populateFilterOptions() {
    const tipos = new Set();
    spaces.forEach(space => {
      if (space.type && space.type.trim() !== '') {
        tipos.add(space.type.trim());
      }
    });
    filterSelect.innerHTML = '<option value="">Todos</option>';
    tipos.forEach(tipo => {
      const option = document.createElement('option');
      option.value = tipo;
      option.textContent = tipo.charAt(0).toUpperCase() + tipo.slice(1);
      filterSelect.appendChild(option);
    });
  }


  function filterAndRender() {
    const q = (searchInput.value || '').toLowerCase().trim();
    const type = filterSelect.value;
    const filtered = spaces.filter(s => {
      if (type && s.type !== type) return false;
      if (!q) return true;
      return (s.title + ' ' + s.desc + ' ' + s.type).toLowerCase().includes(q);
    });
    mountCards(filtered);
  }


  function debounce(fn, t) {
    let to;
    return (...a) => {
      clearTimeout(to);
      to = setTimeout(() => fn(...a), t);
    };
  }


  populateFilterOptions();
  searchInput.addEventListener('input', debounce(filterAndRender, 180));
  filterSelect.addEventListener('change', filterAndRender);


/* Theme toggle */
const toggleThemeBtn = document.getElementById('toggleTheme');
const html = document.documentElement;
const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
let usingDark = (localStorage.getItem('flexspace_theme') === 'dark') || prefersDark;
function applyTheme(){
  if(usingDark) document.body.classList.add('dark'); else document.body.classList.remove('dark');
  localStorage.setItem('flexspace_theme', usingDark ? 'dark' : 'light');
}
toggleThemeBtn.addEventListener('click', ()=>{ usingDark = !usingDark; applyTheme(); });
applyTheme();


/* small helpers */
document.getElementById('year').textContent = new Date().getFullYear();
document.getElementById('newDemoBtn').addEventListener('click', ()=>alert('Solicita√ß√£o de demo enviada (simulada).'));
mountCards(spaces);


/* keyboard: focus first card with ArrowDown */
document.addEventListener('keydown', (e)=>{
  if(e.key === 'j' || e.key === 'ArrowDown'){
    const first = document.querySelector('.card');
    if(first) first.focus();
  }
});


/* touch behavior: show overlay on tap by focusing */
grid.addEventListener('click', (ev)=>{
  const card = ev.target.closest('.card');
  if(!card) return;
  // on small screens we might want to open details directly
  if(window.innerWidth < 700){
    const title = card.querySelector('.card-title').textContent;
    alert(`${title}\n\nOp√ß√µes: Detalhes / Agendar (simula√ß√£o)`);
  }
});


/* quick: update visible count after rating change (so UI reacts) */
window.addEventListener('storage', ()=>{ filterAndRender(); });


/* ====== Leitor de Texto Acess√≠vel ====== */
const readerBtn = document.getElementById('toggleReader');
let reading = false;
let synth = window.speechSynthesis;
let utterance = null;

function getPageText() {
  // pega o conte√∫do textual principal da p√°gina
  const mainText = document.body.innerText
    .replace(/\s+/g, ' ')
    .replace(/Detalhes|Agendar/g, '') // remove bot√µes repetitivos
    .trim();
  return mainText;
}

function startReading() {
  if (synth.speaking) synth.cancel();
  utterance = new SpeechSynthesisUtterance(getPageText());
  utterance.lang = 'pt-BR';
  utterance.rate = 1.0;
  utterance.pitch = 1;
  synth.speak(utterance);
  reading = true;
  readerBtn.classList.add('active');
  readerBtn.title = 'Desativar leitor de texto';
  readerBtn.setAttribute('aria-label', 'Desativar leitor de texto');
}

function stopReading() {
  synth.cancel();
  reading = false;
  readerBtn.classList.remove('active');
  readerBtn.title = 'Ativar leitor de texto';
  readerBtn.setAttribute('aria-label', 'Ativar leitor de texto');
}

readerBtn.addEventListener('click', () => {
  if (!reading) {
    startReading();
  } else {
    stopReading();
  }
});

// se o usu√°rio fechar o navegador ou trocar de aba
window.addEventListener('beforeunload', () => synth.cancel());

// feedback visual quando ativo
const style = document.createElement('style');
style.textContent = `
  #toggleReader.active {
    color: var(--accent);
    transform: scale(1.2);
  }
`;
document.head.appendChild(style);

  const contrastBtn = document.getElementById('toggleContrast');
let usingContrast = localStorage.getItem('flexspace_contrast') === 'true';

function applyContrast(){
  if(usingContrast){
    document.body.classList.add('high-contrast');
  } else {
    document.body.classList.remove('high-contrast');
  }
  localStorage.setItem('flexspace_contrast', usingContrast);
}

contrastBtn.addEventListener('click', ()=>{
  usingContrast = !usingContrast;
  applyContrast();
});

applyContrast();


</script>

  <!-- ===== FLEXAI AVAN√áADA (Frontend) ===== -->
<div id="flexai-root" aria-live="polite">
  <button id="flexai-toggle" class="chatbot-button" aria-haspopup="dialog" aria-expanded="false" title="Abrir FlexAI">üí¨</button>

  <aside id="flexai-panel" class="chatbot-panel" role="dialog" aria-label="Assistente FlexAI" aria-hidden="true">
    <header class="chatbot-header">
      <div><strong>FlexAI</strong><div class="small muted">Assistente da FlexSpace</div></div>
      <div>
        <button id="flexai-summarize" title="Resumir conversa" aria-label="Resumir conversa">‚úÇÔ∏è</button>
        <button id="flexai-close" aria-label="Fechar">√ó</button>
      </div>
    </header>

    <section id="flexai-body" class="chatbot-body" tabindex="0" aria-live="polite">
      <div class="bot-message">üëã Ol√°! Sou a <strong>FlexAI</strong>. Posso ajudar com agendamentos, reformular mensagens (para melhorar a comunica√ß√£o), checar o clima da equipe e muito mais. Em que eu te ajudo hoje?</div>
    </section>

    <form id="flexai-form" class="chatbot-input-area" aria-label="Enviar mensagem para FlexAI">
      <input id="flexai-input" type="text" placeholder="Escreva uma mensagem (ex: 'Agendar demo para ter√ßa 10h')" aria-label="Mensagem para FlexAI" autocomplete="off">
      <button id="flexai-send" type="submit" aria-label="Enviar mensagem">‚û§</button>
    </form>

    <div id="flexai-actions" class="chatbot-quick-actions" aria-hidden="false">
      <button data-act="agendar">Agendar demo</button>
      <button data-act="reformular">Reformular mensagem</button>
      <button data-act="clima">Ver clima da equipe</button>
      <button data-act="contato">Contato suporte</button>
    </div>
  </aside>
</div>

<style>
/* (Use as classes from your previous CSS, ajustei para integra√ß√£o) */
#flexai-root { position:fixed; right:20px; bottom:18px; z-index:1200; font-family:Inter, sans-serif; }
.chatbot-button{ width:56px; height:56px; border-radius:50%; background:var(--brand); color:#fff; border:0; box-shadow:0 8px 30px rgba(0,0,0,0.2); cursor:pointer; font-size:22px; }
.chatbot-panel{ width:340px; max-width:92vw; display:flex; flex-direction:column; position:absolute; bottom:72px; right:0; border-radius:12px; overflow:hidden; box-shadow:0 20px 50px rgba(0,0,0,0.25); background:var(--card); }
.chatbot-header{ display:flex; justify-content:space-between; align-items:center; padding:10px 12px; background:linear-gradient(90deg,var(--brand),var(--accent)); color:#fff; }
.chatbot-body{ padding:12px; max-height:320px; overflow:auto; display:flex; flex-direction:column; gap:8px; background:var(--bg); }
.chatbot-input-area{ display:flex; gap:8px; padding:10px; border-top:1px solid rgba(0,0,0,0.06); background:var(--card); }
.chatbot-input-area input{ flex:1; padding:8px 10px; border-radius:8px; border:1px solid rgba(0,0,0,0.08); }
.chatbot-input-area button{ background:var(--brand); color:#fff; border:0; padding:8px 12px; border-radius:8px; cursor:pointer; }
.bot-message,.user-message{ padding:8px 10px; border-radius:10px; max-width:85%; word-break:break-word; }
.bot-message{ background:var(--glass); align-self:flex-start; }
.user-message{ background:var(--brand); color:#fff; align-self:flex-end; }
.chatbot-quick-actions{ display:flex; gap:8px; padding:10px; flex-wrap:wrap; border-top:1px solid rgba(0,0,0,0.04); }
.chatbot-quick-actions button{ background:transparent; border:1px solid rgba(0,0,0,0.06); padding:6px 8px; border-radius:8px; cursor:pointer; }
.small{ font-size:.8rem }
.muted{ opacity:0.9; font-weight:500 }
</style>

<script>
/* ============ CONFIG ============ */
/* Se for usar backend com OpenAI, ajuste a URL */
const API_URL = '/api/flexai'; // endpoint servidor que proxyia p/ OpenAI (opcional)
const USE_REMOTE_AI = false; // true para enviar hist√≥rico ao servidor / IA real

/* armazenamento local */
const STORAGE_KEY_HISTORY = 'flexai_history_v1';

/* elementos */
const root = document.getElementById('flexai-root');
const toggleBtn = document.getElementById('flexai-toggle');
const panel = document.getElementById('flexai-panel');
const closeBtn = document.getElementById('flexai-close');
const bodyEl = document.getElementById('flexai-body');
const form = document.getElementById('flexai-form');
const input = document.getElementById('flexai-input');
const sendBtn = document.getElementById('flexai-send');
const quickActions = document.getElementById('flexai-actions');
const summarizeBtn = document.getElementById('flexai-summarize');

/* estado */
let open = false;
let history = loadHistory();

/* helpers UI */
function openPanel(){
  panel.style.display = 'flex'; panel.setAttribute('aria-hidden','false');
  toggleBtn.setAttribute('aria-expanded','true'); toggleBtn.style.display='none';
  input.focus(); open=true;
}
function closePanel(){
  panel.style.display = 'none'; panel.setAttribute('aria-hidden','true');
  toggleBtn.setAttribute('aria-expanded','false'); toggleBtn.style.display='inline-block';
  open=false;
}
toggleBtn.addEventListener('click', openPanel);
closeBtn.addEventListener('click', closePanel);

/* quick actions */
quickActions.addEventListener('click', (e) => {
  const btn = e.target.closest('button[data-act]');
  if(!btn) return;
  const act = btn.dataset.act;
  if(act==='agendar') handleLocalCommand('agendar demo');
  if(act==='reformular') handleLocalCommand('reformule esta mensagem para um tom construtivo: [texto aqui]');
  if(act==='clima') handleLocalCommand('como est√° o clima da equipe?');
  if(act==='contato') handleLocalCommand('qual o contato de suporte?');
});

/* load / save history */
function loadHistory(){ try{ return JSON.parse(localStorage.getItem(STORAGE_KEY_HISTORY) || '[]'); }catch(e){return []} }
function saveHistory(){ localStorage.setItem(STORAGE_KEY_HISTORY, JSON.stringify(history)); }

/* render history */
function renderMessage(msg){
  const div = document.createElement('div');
  div.className = msg.role === 'user' ? 'user-message' : 'bot-message';
  div.innerHTML = msg.html || escapeHtml(msg.text);
  bodyEl.appendChild(div);
  bodyEl.scrollTop = bodyEl.scrollHeight;
}
function renderAll(){ bodyEl.innerHTML = ''; history.forEach(renderMessage); }

/* escape helper */
function escapeHtml(s){ return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

/* intent & tone detection (basic, extensible) */
function detectIntent(text){
  const t = text.toLowerCase();
  if(/\bagendar\b|\bagendamento\b|\bmarcar\b|\breservar\b/.test(t)) return 'schedule';
  if(/\bcontato\b|\bsuporte\b|\bemail\b|\btelefone\b/.test(t)) return 'contact';
  if(/\breformular\b|\bmelhorar\b|\breformular mensagem\b/.test(t)) return 'reformulate';
  if(/\bclima\b|\bestresse\b|\bmotiva√ß/i.test(t)) return 'mood';
  return 'chat';
}
function detectTone(text){
  const t = text.toLowerCase();
  const negative = /\b(raiva|irritad|frustrad|cansad|sobrecarregad|triste|estressad)\b/;
  const positive = /\b(√≥tim|bom|feliz|animad|grato|gostei|excelente)\b/;
  if(negative.test(t)) return 'negative';
  if(positive.test(t)) return 'positive';
  return 'neutral';
}

/* mediation: reformulate text to constructive tone */
function reformulateText(text, target='construtivo'){
  // regra simples: solicita reformula√ß√£o localmente. Prefer√≠vel usar modelo remoto p/ qualidade melhor.
  return `Vers√£o reformulada (${target}): Ol√° ‚Äî obrigado pelo retorno. Gostaria de sugerir que... (exemplo) ‚Äî original: "${text}"`;
}

/* immediate local handlers for intents */
async function handleLocalCommand(text){
  const intent = detectIntent(text);
  addToHistory({role:'user', text});
  renderMessage({role:'user', text});
  if(intent === 'schedule'){
    const reply = `Posso ajudar a agendar uma demo. Voc√™ pode clicar em "Agendar Demo" no header ou me dizer dia e hor√°rio. Quer que eu simule o agendamento agora?`;
    await pushBotReply(reply);
  } else if(intent === 'contact'){
    await pushBotReply('Nosso e-mail de suporte √© <strong>demo@flexspace.com</strong> ‚Äî podemos abrir uma solicita√ß√£o de contato se quiser.');
  } else if(intent === 'reformulate'){
    // pega texto entre colchetes se o usu√°rio usar o template
    const inner = (text.match(/\[(.*)\]/)||[])[1] || 'mensagem de exemplo';
    const reform = reformulateText(inner);
    await pushBotReply(reform);
  } else if(intent === 'mood'){
    await pushBotReply('Posso checar sinais de estresse na conversa. Recomendo pequenas pausas e reorganiza√ß√£o de tarefas. Quer um resumo do tom atual?');
  } else {
    // fallback para IA remota ou resposta local generica
    if(USE_REMOTE_AI){
      const reply = await askRemoteAI(history.concat([{role:'user', text}]));
      await pushBotReply(reply);
    } else {
      await pushBotReply('Desculpe, ainda estou aprendendo ‚ùó Tente pedir "agendar", "reformular" ou "contato".');
    }
  }
}

/* push bot reply to UI + history */
async function pushBotReply(text){
  const msg = {role:'assistant', text, html: text};
  history.push(msg); saveHistory();
  renderMessage(msg);
}

/* send message flow */
form.addEventListener('submit', async (e) => {
  e.preventDefault();
  const text = input.value.trim();
  if(!text) return;
  input.value = '';
  history.push({role:'user', text}); saveHistory();
  renderMessage({role:'user', text});
  const intent = detectIntent(text);
  const tone = detectTone(text);

  // quick local responses for certain intents
  if(intent==='reformulate'){
    // expects format: "reformular: <texto>" or "reformule esta mensagem: <texto>"
    const inner = (text.match(/reformular.*[:\-]\s*(.*)/i) || (text.match(/reformul.*(?:esta mensagem|mensagem)\s*[:\-]\s*(.*)/i)))?.[1];
    const source = inner || text;
    const reform = reformulateText(source, 'construtivo');
    history.push({role:'assistant', text:reform, html: reform}); saveHistory();
    renderMessage({role:'assistant', text: reform, html: reform});
    return;
  }

  // if we want remote AI: send history
  if(USE_REMOTE_AI){
    // small typing indicator
    const typing = document.createElement('div'); typing.className='bot-message'; typing.id='flexai-typing'; typing.innerText = 'FlexAI est√° digitando...'; bodyEl.appendChild(typing); bodyEl.scrollTop = bodyEl.scrollHeight;
    try{
      const reply = await askRemoteAI(history);
      document.getElementById('flexai-typing')?.remove();
      history.push({role:'assistant', text: reply, html: reply}); saveHistory();
      renderMessage({role:'assistant', text: reply, html: reply});
    }catch(err){
      document.getElementById('flexai-typing')?.remove();
      const errorMsg = 'Erro ao contactar a IA remota. Tente novamente mais tarde.';
      history.push({role:'assistant', text: errorMsg}); saveHistory();
      renderMessage({role:'assistant', text: errorMsg});
      console.error(err);
    }
  } else {
    // local best-effort reply
    // if the tone is negative, offer mediation
    if(tone === 'negative'){
      const offer = 'Percebo que a mensagem tem tom negativo. Deseja que eu sugira uma vers√£o mais construtiva para enviar ao seu colega/gestor?';
      history.push({role:'assistant', text: offer}); saveHistory();
      renderMessage({role:'assistant', text: offer});
    } else {
      const simple = `Entendi. Posso: (1) agendar/organizar, (2) reformular mensagens, (3) fornecer contato. Diga a op√ß√£o ou pergunte algo mais espec√≠fico.`;
      history.push({role:'assistant', text: simple}); saveHistory();
      renderMessage({role:'assistant', text: simple});
    }
  }
});

/* summarizer (ex.: resumir hist√≥rico para gestor) */
summarizeBtn.addEventListener('click', async () => {
  if(USE_REMOTE_AI){
    const typing = document.createElement('div'); typing.className='bot-message'; typing.innerText = 'Gerando resumo...'; bodyEl.appendChild(typing);
    try{
      const reply = await askRemoteAI([{role:'system', text:'Resuma esta conversa de forma objetiva:'}, ...history]);
      document.getElementById('flexai-typing')?.remove();
      history.push({role:'assistant', text: reply, html: reply}); saveHistory();
      renderMessage({role:'assistant', text: reply, html: reply});
    }catch(e){ console.error(e); }
  } else {
    const summary = generateLocalSummary(history);
    history.push({role:'assistant', text:summary}); saveHistory();
    renderMessage({role:'assistant', text:summary});
  }
});

/* small local summary generator */
function generateLocalSummary(hist){
  const userMsgs = hist.filter(m=>m.role==='user').slice(-6).map(m=>m.text).join(' ‚Ä¢ ');
  return `Resumo curto: t√≥picos recentes: ${userMsgs || 'nenhum t√≥pico detectado'}. Sugest√µes: verificar agendamentos pendentes e clima da equipe.`;
}

/* ask remote AI via server proxy (backend necess√°rio) */
async function askRemoteAI(messages){
  // messages: array of {role:'user'|'assistant'|'system', text}
  const payload = { messages: messages.map(m=> ({ role: m.role, content: m.text }) ), info: { source: 'flexspace-demo' } };
  const res = await fetch(API_URL, {
    method:'POST',
    headers:{ 'Content-Type':'application/json' },
    body: JSON.stringify(payload),
  });
  if(!res.ok) throw new Error('Erro na API: ' + res.status);
  const data = await res.json();
  // espera { reply: 'texto' }
  return data.reply || 'Sem resposta da IA remota.';
}

/* restore and render previous history */
renderAll();

/* keyboard support: Esc fecha */
document.addEventListener('keydown', (e)=>{
  if(e.key === 'Escape' && open) closePanel();
});

/* expose simple API to console for debug */
window.FlexAI = {
  open: openPanel,
  close: closePanel,
  send: (text)=> handleLocalCommand(text),
  history: ()=> history
};

  async function enviarMensagem() {
  const input = document.getElementById('mensagem');
  const area = document.getElementById('resposta');
  const texto = input.value.trim();

  if (!texto) return;

  area.innerText = "Pensando... ü§î";

  try {
    const resposta = await fetch("https://stackblitzstartersrlraqwzy-q0rp--3000--cf284e50.local-credentialless.webcontainer.io/", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ mensagem: texto })
    });

    const data = await resposta.json();
    area.innerText = "üí¨ " + data.resposta;
  } catch (err) {
    console.error(err);
    area.innerText = "Erro ao conectar com o servidor üò≠";
  }
}
</script>

<input id="mensagem" placeholder="Fale com a IA Flex ü§ñ">
<button onclick="enviarMensagem()">Enviar</button>
<p id="resposta"></p>
</script>

</script>
</body>
</html>











